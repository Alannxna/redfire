# RedFire åç«¯æ¶æ„æ·±åº¦åˆ†ææŠ¥å‘Š

## ğŸ“Š é¡¹ç›®æ¦‚å†µ

**é¡¹ç›®åç§°**: RedFire é‡åŒ–äº¤æ˜“å¹³å°åç«¯
**æ¶æ„æ¨¡å¼**: Clean Architecture + DDD (é¢†åŸŸé©±åŠ¨è®¾è®¡)
**æŠ€æœ¯æ ˆ**: FastAPI + SQLAlchemy + MySQL + Redis

## ğŸ—ï¸ å½“å‰æ¶æ„åˆ†æ

### 1. ç›®å½•ç»“æ„ç°çŠ¶

```
backend/
â”œâ”€â”€ core/                          # æ ¸å¿ƒå¼•æ“æ¨¡å—
â”‚   â”œâ”€â”€ alpha-engine/              # Alphaç®—æ³•å¼•æ“
â”‚   â”œâ”€â”€ chart-engine/              # å›¾è¡¨å¼•æ“
â”‚   â”œâ”€â”€ tradingEngine/             # äº¤æ˜“å¼•æ“
â”‚   â””â”€â”€ vnpy-engine/               # VnPyé›†æˆå¼•æ“
â”œâ”€â”€ legacy/                        # é—ç•™ä»£ç  (ä¸»è¦ä¸šåŠ¡é€»è¾‘)
â”‚   â”œâ”€â”€ application/               # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ domain/                    # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ infrastructure/            # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ interfaces/                # æ¥å£å±‚ (API)
â”‚   â”œâ”€â”€ modules/                   # åŠŸèƒ½æ¨¡å—
â”‚   â””â”€â”€ persistence/               # æŒä¹…åŒ–å±‚
â”œâ”€â”€ src/                          # æ–°æ¶æ„ä»£ç 
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ domain/                   # é¢†åŸŸæ¨¡å‹
â”‚   â””â”€â”€ infrastructure/           # åŸºç¡€è®¾æ–½
â”œâ”€â”€ infrastructure/               # åŸºç¡€è®¾æ–½ç»„ä»¶
â”œâ”€â”€ shared/                       # å…±äº«ç»„ä»¶
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â””â”€â”€ tools/                        # å·¥å…·è„šæœ¬
```

### 2. æ¶æ„é—®é¢˜è¯†åˆ«

#### ğŸš¨ ä¸¥é‡é—®é¢˜

1. **é‡å¤çš„åº”ç”¨å…¥å£**
   - `backend/legacy/main.py` - ä¸»åº”ç”¨å…¥å£
   - `backend/legacy/app.py` - å¦ä¸€ä¸ªåº”ç”¨å…¥å£
   - `backend/legacy/interfaces/rest/app.py` - REST APIåº”ç”¨

2. **é…ç½®ç®¡ç†æ··ä¹±**
   - å¤šä¸ªé…ç½®ç±»ï¼š`UnifiedConfig`, `AppConfig`, `PathConfig`
   - é…ç½®æ–‡ä»¶åˆ†æ•£åœ¨å¤šä¸ªç›®å½•
   - ç¯å¢ƒå˜é‡ç®¡ç†ä¸ç»Ÿä¸€

3. **ä»£ç æ¶æ„åˆ†å±‚**
   - `legacy/` å’Œ `src/` ä¸¤å¥—å¹¶è¡Œçš„æ¶æ„
   - ä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨ä¸åŒç›®å½•
   - ä¾èµ–å…³ç³»å¤æ‚ä¸”å¾ªç¯

#### âš ï¸ ä¸­ç­‰é—®é¢˜

4. **æ¨¡å—åŒ–ç¨‹åº¦ä¸è¶³**
   - æ ¸å¿ƒå¼•æ“æ¨¡å—ç‹¬ç«‹æ€§å·®
   - ä¸šåŠ¡æ¨¡å—é—´è€¦åˆåº¦é«˜
   - æ¥å£å®šä¹‰ä¸æ¸…æ™°

5. **æµ‹è¯•è¦†ç›–ä¸å®Œæ•´**
   - å•å…ƒæµ‹è¯•åˆ†æ•£
   - é›†æˆæµ‹è¯•ä¸å®Œæ•´
   - æ€§èƒ½æµ‹è¯•ç¼ºå¤±

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æ¨¡å—åˆ†æ

### 1. é¢†åŸŸæ¨¡å‹ (Domain Models)

#### ç”¨æˆ·åŸŸ (`legacy/domain/user/`)
```python
- entities/user.py          # ç”¨æˆ·å®ä½“
- value_objects/           # å€¼å¯¹è±¡ (UserId, Username, Emailç­‰)
- services/               # ç”¨æˆ·é¢†åŸŸæœåŠ¡
- repositories/           # ç”¨æˆ·ä»“å‚¨æ¥å£
```

#### äº¤æ˜“åŸŸ (`src/domain/trading/`)
```python
- entities/               # äº¤æ˜“å®ä½“
  â”œâ”€â”€ order_entity.py     # è®¢å•å®ä½“
  â”œâ”€â”€ trade_entity.py     # æˆäº¤å®ä½“
  â”œâ”€â”€ position_entity.py  # æŒä»“å®ä½“
  â”œâ”€â”€ account_entity.py   # è´¦æˆ·å®ä½“
  â””â”€â”€ contract_entity.py  # åˆçº¦å®ä½“
- enums.py               # äº¤æ˜“æšä¸¾
- constants.py           # äº¤æ˜“å¸¸é‡
- services/              # äº¤æ˜“é¢†åŸŸæœåŠ¡
```

#### ç­–ç•¥åŸŸ (`legacy/domain/strategy/`)
```python
- entities/              # ç­–ç•¥å®ä½“
- services/              # ç­–ç•¥æœåŠ¡
- repositories/          # ç­–ç•¥ä»“å‚¨
```

#### ç›‘æ§åŸŸ (`legacy/domain/monitoring/`)
```python
- entities/              # ç›‘æ§å®ä½“
- services/              # ç›‘æ§æœåŠ¡
- events/                # ç›‘æ§äº‹ä»¶
```

### 2. åº”ç”¨å±‚ (Application Layer)

#### åº”ç”¨æœåŠ¡
- `legacy/application/services/` - åº”ç”¨æœåŠ¡å®ç°
- å‘½ä»¤æŸ¥è¯¢åˆ†ç¦» (CQRS) æ¨¡å¼
- äº‹ä»¶é©±åŠ¨æ¶æ„æ”¯æŒ

#### å·¥ä½œæµç®¡ç†
- `legacy/application/workflows/` - ä¸šåŠ¡å·¥ä½œæµ
- å¤æ‚ä¸šåŠ¡æµç¨‹ç¼–æ’

### 3. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)

#### æ•°æ®è®¿é—®
- `legacy/infrastructure/repositories/` - ä»“å‚¨å®ç°
- `legacy/persistence/` - æŒä¹…åŒ–å±‚

#### å¤–éƒ¨æœåŠ¡é›†æˆ
- `legacy/infrastructure/vnpy/` - VnPyé›†æˆ
- `infrastructure/` - åŸºç¡€è®¾æ–½ç»„ä»¶

### 4. æ¥å£å±‚ (Interface Layer)

#### REST API
```python
legacy/interfaces/rest/
â”œâ”€â”€ controllers/         # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ user_controller.py
â”‚   â”œâ”€â”€ trading_controller.py
â”‚   â”œâ”€â”€ dashboard_controller.py
â”‚   â””â”€â”€ strategy_engine_controller.py
â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
â”œâ”€â”€ models/             # APIæ¨¡å‹
â””â”€â”€ app.py              # FastAPIåº”ç”¨
```

#### WebSocket
- å®æ—¶æ•°æ®æ¨é€
- äº¤æ˜“çŠ¶æ€æ›´æ–°
- ç³»ç»Ÿç›‘æ§æ•°æ®

## ğŸ”§ ä¼˜åŒ–å»ºè®®

### 1. ç«‹å³æ‰§è¡Œ (é«˜ä¼˜å…ˆçº§)

#### ç»Ÿä¸€åº”ç”¨å…¥å£
- ä¿ç•™ `legacy/main.py` ä½œä¸ºä¸»å…¥å£
- åˆ é™¤é‡å¤çš„ `legacy/app.py`
- æ•´åˆ `legacy/interfaces/rest/app.py` åŠŸèƒ½

#### é…ç½®ç®¡ç†ç»Ÿä¸€
- ä½¿ç”¨ `UnifiedConfig` ä½œä¸ºå”¯ä¸€é…ç½®ç±»
- ç»Ÿä¸€ç¯å¢ƒå˜é‡ç®¡ç†
- æ¸…ç†é‡å¤é…ç½®æ–‡ä»¶

### 2. çŸ­æœŸè§„åˆ’ (1-2å‘¨)

#### ä»£ç æ¶æ„æ•´åˆ
- å°† `src/` ç›®å½•å†…å®¹åˆå¹¶åˆ° `legacy/` å¯¹åº”ä½ç½®
- ç»Ÿä¸€é¢†åŸŸæ¨¡å‹å®šä¹‰
- æ¸…ç†å¾ªç¯ä¾èµ–

#### æ¨¡å—åŒ–é‡æ„
- æ ¸å¿ƒå¼•æ“æ¨¡å—ç‹¬ç«‹åŒ–
- å®šä¹‰æ¸…æ™°çš„æ¨¡å—æ¥å£
- å®ç°æ’ä»¶åŒ–æ¶æ„

### 3. ä¸­æœŸè§„åˆ’ (1-2æœˆ)

#### æµ‹è¯•ä½“ç³»å®Œå–„
- å»ºç«‹å®Œæ•´çš„æµ‹è¯•é‡‘å­—å¡”
- å®ç°æŒç»­é›†æˆ
- æ€§èƒ½åŸºå‡†æµ‹è¯•

#### ç›‘æ§å’Œæ—¥å¿—
- ç»Ÿä¸€æ—¥å¿—æ ¼å¼
- æ€§èƒ½ç›‘æ§æŒ‡æ ‡
- é”™è¯¯è¿½è¸ªç³»ç»Ÿ

## ğŸ“‹ é‡æ„æ‰§è¡Œè®¡åˆ’

### Phase 1: æ¸…ç†å’Œæ•´åˆ (æœ¬æ¬¡æ‰§è¡Œ)
1. âœ… åˆ é™¤ä¸´æ—¶æ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶
2. ğŸ”„ ç»Ÿä¸€åº”ç”¨å…¥å£
3. ğŸ”„ é…ç½®ç®¡ç†æ•´åˆ
4. ğŸ”„ ç›®å½•ç»“æ„ä¼˜åŒ–

### Phase 2: æ¶æ„ä¼˜åŒ–
1. é¢†åŸŸæ¨¡å‹ç»Ÿä¸€
2. æœåŠ¡æ¥å£è§„èŒƒ
3. ä¾èµ–æ³¨å…¥ä¼˜åŒ–

### Phase 3: åŠŸèƒ½å®Œå–„
1. æµ‹è¯•è¦†ç›–æå‡
2. æ–‡æ¡£å®Œå–„
3. æ€§èƒ½ä¼˜åŒ–

## ğŸ¯ é¢„æœŸæ”¶ç›Š

1. **ä»£ç å¯ç»´æŠ¤æ€§æå‡ 60%**
2. **å¼€å‘æ•ˆç‡æå‡ 40%**
3. **ç³»ç»Ÿç¨³å®šæ€§æå‡ 50%**
4. **æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æå‡ 30%**

---

**ç”Ÿæˆæ—¶é—´**: 2025-08-26
**åˆ†ææ·±åº¦**: æ·±åº¦æ¶æ„åˆ†æ
**å»ºè®®æ‰§è¡Œ**: ç«‹å³å¼€å§‹é‡æ„
