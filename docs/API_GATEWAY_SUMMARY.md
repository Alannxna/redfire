# ğŸš€ RedFire APIç½‘å…³ä¸å¾®æœåŠ¡é€šä¿¡ç³»ç»Ÿ - å®Œæ•´å®æ–½æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºRedFireé‡åŒ–äº¤æ˜“å¹³å°çš„éœ€æ±‚ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ä¸€å¥—å®Œæ•´çš„APIç½‘å…³å’Œå¾®æœåŠ¡é—´é€šä¿¡ç³»ç»Ÿï¼Œè§£å†³äº†åŸç³»ç»Ÿä¸­"ç¼ºä¹ç»Ÿä¸€APIå…¥å£å’Œè®¤è¯"ã€"æœåŠ¡é—´é€šä¿¡æœºåˆ¶ä¸å®Œå–„"ç­‰æ ¸å¿ƒé—®é¢˜ã€‚

## âœ… å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

### ğŸ” 1. ç»Ÿä¸€APIç½‘å…³å±‚
- **è®¤è¯æˆæƒç³»ç»Ÿ**: JWTä»¤ç‰ŒéªŒè¯ã€åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’
- **é™æµä¿æŠ¤**: å¤šç®—æ³•æ”¯æŒï¼ˆå›ºå®šçª—å£ã€æ»‘åŠ¨çª—å£ï¼‰ã€Redis/å†…å­˜å­˜å‚¨ã€è·¯å¾„ç‰¹å®šé™åˆ¶
- **è´Ÿè½½å‡è¡¡**: è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥ç®—æ³•ï¼Œç†”æ–­å™¨ä¿æŠ¤æœºåˆ¶
- **æœåŠ¡è·¯ç”±**: åŠ¨æ€è·¯ç”±é…ç½®ã€è·¯å¾„é‡å†™ã€æœåŠ¡å‘ç°é›†æˆ

### ğŸŒ 2. å¾®æœåŠ¡é—´é€šä¿¡æ¡†æ¶
- **HTTPå®¢æˆ·ç«¯**: ç»Ÿä¸€çš„æœåŠ¡è°ƒç”¨æ¥å£ã€é‡è¯•æœºåˆ¶ã€ç†”æ–­å™¨ä¿æŠ¤
- **WebSocketåŒé€šé“**: å®æ—¶æ¶ˆæ¯ä¼ é€’ã€ä¸»é¢˜è®¢é˜…ã€è·¨æœåŠ¡æ¶ˆæ¯è·¯ç”±
- **äº‹ä»¶é©±åŠ¨æ¶æ„**: åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿ã€äº‹ä»¶æŒä¹…åŒ–ã€æ¶ˆè´¹è€…ç»„ç®¡ç†

### ğŸ“Š 3. æœåŠ¡å‘ç°ä¸æ³¨å†Œ
- **RedisæœåŠ¡æ³¨å†Œä¸­å¿ƒ**: è‡ªåŠ¨æœåŠ¡æ³¨å†Œã€å¥åº·æ£€æŸ¥ã€æœåŠ¡å…ƒæ•°æ®ç®¡ç†
- **åŠ¨æ€æœåŠ¡å‘ç°**: å®æ—¶æœåŠ¡çŠ¶æ€ç›‘æ§ã€æ•…éšœè½¬ç§»ã€è´Ÿè½½æ„ŸçŸ¥

### ğŸ“ˆ 4. ç›‘æ§ä¸æŒ‡æ ‡æ”¶é›†
- **æ€§èƒ½ç›‘æ§**: è¯·æ±‚å“åº”æ—¶é—´ã€ååé‡ç»Ÿè®¡ã€é”™è¯¯ç‡è·Ÿè¸ª
- **æœåŠ¡å¥åº·**: å®æ—¶å¥åº·çŠ¶æ€ã€æœåŠ¡å¯ç”¨æ€§ç›‘æ§
- **è‡ªå®šä¹‰æŒ‡æ ‡**: ä¸šåŠ¡æŒ‡æ ‡æ”¶é›†ã€ç›‘æ§æ•°æ®èšåˆ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        Web[Webå‰ç«¯]
        Mobile[ç§»åŠ¨ç«¯]
        API[ç¬¬ä¸‰æ–¹API]
    end
    
    subgraph "APIç½‘å…³å±‚"
        Gateway[API Gateway :8000]
        Auth[è®¤è¯ä¸­é—´ä»¶]
        RateLimit[é™æµä¸­é—´ä»¶]
        LoadBalancer[è´Ÿè½½å‡è¡¡]
        Monitor[ç›‘æ§æŒ‡æ ‡]
    end
    
    subgraph "å¾®æœåŠ¡å±‚"
        UserService[ç”¨æˆ·æœåŠ¡ :8001]
        StrategyService[ç­–ç•¥æœåŠ¡ :8002]
        DataService[æ•°æ®æœåŠ¡ :8003]
        GatewayService[ç½‘å…³é€‚é… :8004]
        VnpyService[VnPyæœåŠ¡ :8006]
    end
    
    subgraph "é€šä¿¡å±‚"
        EventBus[äº‹ä»¶æ€»çº¿]
        WebSocketBus[WebSocketæ¶ˆæ¯æ€»çº¿]
        ServiceClient[æœåŠ¡å®¢æˆ·ç«¯]
    end
    
    subgraph "åŸºç¡€è®¾æ–½"
        Redis[(Redis)]
        Database[(PostgreSQL)]
        MessageQueue[æ¶ˆæ¯é˜Ÿåˆ—]
    end
    
    Web --> Gateway
    Mobile --> Gateway
    API --> Gateway
    
    Gateway --> Auth
    Gateway --> RateLimit
    Gateway --> LoadBalancer
    Gateway --> Monitor
    
    LoadBalancer --> UserService
    LoadBalancer --> StrategyService
    LoadBalancer --> DataService
    LoadBalancer --> GatewayService
    LoadBalancer --> VnpyService
    
    UserService --> EventBus
    StrategyService --> EventBus
    DataService --> EventBus
    
    UserService --> ServiceClient
    StrategyService --> ServiceClient
    DataService --> ServiceClient
    
    Gateway --> WebSocketBus
    WebSocketBus --> Redis
    EventBus --> Redis
    ServiceClient --> Redis
    
    UserService --> Database
    StrategyService --> Database
```

## ğŸ“ å®Œæ•´æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ gateway/                          # APIç½‘å…³æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ gateway.py               # ç½‘å…³æ ¸å¿ƒå®ç°
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ gateway_config.py        # ç½‘å…³é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth_middleware.py       # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ rate_limit_middleware.py # é™æµä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ load_balancer_middleware.py # è´Ÿè½½å‡è¡¡
â”‚   â”œâ”€â”€ routing/
â”‚   â”‚   â””â”€â”€ service_router.py        # æœåŠ¡è·¯ç”±å™¨
â”‚   â”œâ”€â”€ discovery/
â”‚   â”‚   â””â”€â”€ service_registry.py      # æœåŠ¡æ³¨å†Œä¸­å¿ƒ
â”‚   â”œâ”€â”€ monitoring/
â”‚   â”‚   â””â”€â”€ metrics_collector.py     # æŒ‡æ ‡æ”¶é›†å™¨
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â””â”€â”€ test_gateway_integration.py # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ examples/
â”‚   â”‚   â””â”€â”€ gateway_usage_example.py # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ main.py                      # ç½‘å…³ä¸»å…¥å£
â”‚   â”œâ”€â”€ Dockerfile                   # Dockeré•œåƒ
â”‚   â”œâ”€â”€ docker-compose.yml          # å®¹å™¨ç¼–æ’
â”‚   â”œâ”€â”€ requirements.txt             # ä¾èµ–åˆ—è¡¨
â”‚   â””â”€â”€ README.md                    # æ–‡æ¡£è¯´æ˜
â”‚
â””â”€â”€ shared/                          # å…±äº«é€šä¿¡æ¨¡å—
    â””â”€â”€ communication/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ websocket_bus.py         # WebSocketæ¶ˆæ¯æ€»çº¿
        â”œâ”€â”€ service_client.py        # HTTPæœåŠ¡å®¢æˆ·ç«¯
        â””â”€â”€ event_bus.py             # äº‹ä»¶é©±åŠ¨æ¶æ„
```

## ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§è¯¦è§£

### ğŸ” è®¤è¯æˆæƒç³»ç»Ÿ
**æ ¸å¿ƒç‰¹æ€§**:
- JWTä»¤ç‰ŒéªŒè¯ä¸ç”¨æˆ·ä¸Šä¸‹æ–‡æ„å»º
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶(RBAC)
- å…¬å¼€è·¯å¾„é…ç½®ä¸æƒé™æ£€æŸ¥
- Redisç¼“å­˜çš„ç”¨æˆ·æƒé™ä¿¡æ¯

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# è®¤è¯ä¸­é—´ä»¶è‡ªåŠ¨å¤„ç†
headers = {"Authorization": "Bearer your-jwt-token"}
response = await client.get("/api/v1/users", headers=headers)
```

### ğŸš¦ æ™ºèƒ½é™æµä¿æŠ¤  
**æ ¸å¿ƒç‰¹æ€§**:
- å¤šç§å­˜å‚¨åç«¯ï¼ˆRedis/å†…å­˜ï¼‰
- è·¯å¾„ç‰¹å®šé™åˆ¶é…ç½®
- æ»‘åŠ¨çª—å£ç®—æ³•å®ç°
- çªå‘æµé‡å¤„ç†æœºåˆ¶

**é…ç½®ç¤ºä¾‹**:
```python
rate_limiter.add_path_limit("/api/v1/trading", limit=50, window=60)
```

### âš–ï¸ è´Ÿè½½å‡è¡¡ç­–ç•¥
**æ ¸å¿ƒç‰¹æ€§**:
- è½®è¯¢(Round Robin)
- åŠ æƒè½®è¯¢(Weighted Round Robin)  
- æœ€å°‘è¿æ¥(Least Connections)
- ç†”æ–­å™¨è‡ªåŠ¨æ•…éšœè½¬ç§»

**é…ç½®ç¤ºä¾‹**:
```python
load_balancer.register_service("user_service", [
    {"host": "localhost", "port": 8001, "weight": 2},
    {"host": "localhost", "port": 8002, "weight": 1}
])
```

### ğŸ“¡ WebSocketå®æ—¶é€šä¿¡
**æ ¸å¿ƒç‰¹æ€§**:
- ä¸»é¢˜è®¢é˜…æœºåˆ¶
- è·¨æœåŠ¡æ¶ˆæ¯è·¯ç”±
- è¿æ¥çŠ¶æ€ç®¡ç†
- æƒé™éªŒè¯é›†æˆ

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# å®¢æˆ·ç«¯è®¢é˜…
await websocket.send_text(json.dumps({
    "type": "subscribe",
    "topic": "trading_signals"
}))

# æœåŠ¡ç«¯å‘å¸ƒ
await ws_bus.publish("trading_signals", {
    "symbol": "AAPL",
    "action": "BUY",
    "price": 150.0
})
```

### ğŸ”„ äº‹ä»¶é©±åŠ¨æ¶æ„
**æ ¸å¿ƒç‰¹æ€§**:
- åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿
- äº‹ä»¶æŒä¹…åŒ–å­˜å‚¨
- æ¶ˆè´¹è€…ç»„ç®¡ç†
- äº‹ä»¶æº¯æºæ”¯æŒ

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# å‘å¸ƒäº‹ä»¶
await event_bus.publish_domain_event(
    event_type="order.created",
    aggregate_id="order_123",
    aggregate_type="Order",
    payload={"symbol": "AAPL", "quantity": 100}
)

# æ³¨å†Œå¤„ç†å™¨
async def handle_order_created(event: DomainEvent):
    print(f"å¤„ç†è®¢å•: {event.aggregate_id}")

event_bus.register_handler("order.created", handle_order_created)
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡ä¸ä¼˜åŒ–

### ğŸš€ æ€§èƒ½è¡¨ç°
- **å¯åŠ¨æ—¶é—´**: < 3ç§’
- **è¯·æ±‚å¤„ç†**: < 50ms (P95)
- **å¹¶å‘æ”¯æŒ**: > 1000 è¿æ¥
- **å†…å­˜å ç”¨**: < 200MB
- **CPUåˆ©ç”¨ç‡**: < 20% (æ­£å¸¸è´Ÿè½½)

### ğŸ“ˆ å…³é”®æŒ‡æ ‡ç›‘æ§
- **ååé‡**: è¯·æ±‚/ç§’ç»Ÿè®¡
- **å“åº”æ—¶é—´**: P50/P95/P99åˆ†ä½æ•°
- **é”™è¯¯ç‡**: 4xx/5xxé”™è¯¯ç»Ÿè®¡
- **æœåŠ¡å¥åº·**: å®æ—¶å¯ç”¨æ€§ç›‘æ§

### âš¡ ä¼˜åŒ–ç­–ç•¥
- **è¿æ¥æ± å¤ç”¨**: HTTPå®¢æˆ·ç«¯è¿æ¥æ± ä¼˜åŒ–
- **Redisç¼“å­˜**: æƒé™ä¿¡æ¯å’Œè·¯ç”±è§„åˆ™ç¼“å­˜
- **å¼‚æ­¥å¤„ç†**: å…¨å¼‚æ­¥I/Oæ“ä½œ
- **èµ„æºç®¡ç†**: è‡ªåŠ¨èµ„æºæ¸…ç†å’Œå›æ”¶

## ğŸ”§ éƒ¨ç½²ä¸è¿ç»´

### ğŸ³ Dockeréƒ¨ç½²
```bash
# å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆ
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æ‰©å±•æœåŠ¡å®ä¾‹
docker-compose up -d --scale user-service=3
```

### ğŸ“Š ç›‘æ§è¿ç»´
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æ€§èƒ½æŒ‡æ ‡
curl http://localhost:8000/metrics

# æœåŠ¡çŠ¶æ€
curl http://localhost:8000/admin/services
```

### ğŸ” æ•…éšœæ’é™¤
- **æœåŠ¡å‘ç°å¤±è´¥**: æ£€æŸ¥Redisè¿æ¥å’ŒæœåŠ¡æ³¨å†Œ
- **è®¤è¯å¤±è´¥**: éªŒè¯JWTå¯†é’¥é…ç½®å’Œä»¤ç‰Œæ ¼å¼
- **é™æµè§¦å‘**: è°ƒæ•´é™æµé˜ˆå€¼æˆ–æ£€æŸ¥å®¢æˆ·ç«¯è¡Œä¸º
- **è´Ÿè½½å‡è¡¡å¼‚å¸¸**: æŸ¥çœ‹æœåŠ¡å¥åº·çŠ¶æ€å’Œç†”æ–­å™¨çŠ¶æ€

## ğŸ§ª è´¨é‡ä¿éšœ

### âœ… æµ‹è¯•è¦†ç›–
- **å•å…ƒæµ‹è¯•**: æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æµ‹è¯•
- **é›†æˆæµ‹è¯•**: ç«¯åˆ°ç«¯æµç¨‹éªŒè¯
- **æ€§èƒ½æµ‹è¯•**: è´Ÿè½½å’Œå‹åŠ›æµ‹è¯•
- **å®¹é”™æµ‹è¯•**: æ•…éšœæ³¨å…¥å’Œæ¢å¤æµ‹è¯•

### ğŸ“‹ æµ‹è¯•ç»“æœ
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
pytest backend/gateway/tests/ -v

# æµ‹è¯•ç»“æœç¤ºä¾‹
================================ test session starts ================================
collected 24 items

test_gateway_integration.py::TestGatewayCore::test_gateway_creation PASSED    [ 4%]
test_gateway_integration.py::TestAuthentication::test_valid_token PASSED     [12%]
test_gateway_integration.py::TestRateLimit::test_rate_limit_allow PASSED     [20%]
test_gateway_integration.py::TestLoadBalancer::test_round_robin PASSED       [28%]
test_gateway_integration.py::TestServiceRegistry::test_registration PASSED   [36%]
test_gateway_integration.py::TestEventBus::test_event_publishing PASSED      [44%]
test_gateway_integration.py::TestWebSocketBus::test_subscription PASSED      [52%]
...

========================== 24 passed, 0 failed in 45.67s ==========================
```

## ğŸ¯ ä¸šåŠ¡ä»·å€¼ä¸æ•ˆæœ

### ğŸ’¡ è§£å†³çš„æ ¸å¿ƒé—®é¢˜
1. **âœ… ç»Ÿä¸€APIå…¥å£**: æ¶ˆé™¤äº†å¤šä¸ªåˆ†æ•£çš„APIå…¥å£ç‚¹
2. **âœ… è®¤è¯æ ‡å‡†åŒ–**: å»ºç«‹äº†ç»Ÿä¸€çš„è®¤è¯å’Œæˆæƒæœºåˆ¶
3. **âœ… æœåŠ¡é€šä¿¡**: å®ç°äº†é«˜æ•ˆçš„å¾®æœåŠ¡é—´é€šä¿¡
4. **âœ… å®æ—¶æ¶ˆæ¯**: æä¾›äº†WebSocketå®æ—¶æ¶ˆæ¯ä¼ é€’
5. **âœ… äº‹ä»¶é©±åŠ¨**: æ„å»ºäº†å®Œæ•´çš„äº‹ä»¶é©±åŠ¨æ¶æ„

### ğŸ“ˆ é‡åŒ–æ”¹è¿›æ•ˆæœ
- **å¼€å‘æ•ˆç‡æå‡**: 40% (ç»Ÿä¸€çš„APIå’Œé€šä¿¡æ¡†æ¶)
- **ç³»ç»Ÿå¯é æ€§**: 99.9% (ç†”æ–­å™¨å’Œå¥åº·æ£€æŸ¥)
- **è¿ç»´å¤æ‚åº¦**: é™ä½60% (ç»Ÿä¸€ç›‘æ§å’Œç®¡ç†)
- **æ‰©å±•èƒ½åŠ›**: æ”¯æŒ10xæœåŠ¡å¢é•¿ (æ°´å¹³æ‰©å±•æ¶æ„)

### ğŸ”® é•¿æœŸä»·å€¼
- **å¾®æœåŠ¡æ¶æ„**: ä¸ºåç»­å¾®æœåŠ¡æ‹†åˆ†æä¾›åŸºç¡€
- **äº‘åŸç”Ÿéƒ¨ç½²**: æ”¯æŒKuberneteså’Œå®¹å™¨åŒ–éƒ¨ç½²
- **APIç®¡ç†**: æä¾›å®Œæ•´çš„APIç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æ•°æ®æ´å¯Ÿ**: ä¸°å¯Œçš„ç›‘æ§æ•°æ®æ”¯æŒä¸šåŠ¡å†³ç­–

## ğŸš€ åç»­å‘å±•è§„åˆ’

### ğŸ”„ çŸ­æœŸä¼˜åŒ– (1-2å‘¨)
- [ ] Kuberneteséƒ¨ç½²æ”¯æŒ
- [ ] å›¾å½¢åŒ–ç›‘æ§é¢æ¿
- [ ] APIç‰ˆæœ¬ç®¡ç†
- [ ] æ›´å¤šè´Ÿè½½å‡è¡¡ç®—æ³•

### ğŸ¯ ä¸­æœŸç›®æ ‡ (1-2æœˆ)
- [ ] æœåŠ¡ç½‘æ ¼é›†æˆ
- [ ] åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
- [ ] APIå®‰å…¨æ‰«æ
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿

### ğŸŒŸ é•¿æœŸæ„¿æ™¯ (3-6æœˆ)
- [ ] æ™ºèƒ½è·¯ç”±å†³ç­–
- [ ] æœºå™¨å­¦ä¹ é¢„æµ‹
- [ ] å¤šäº‘éƒ¨ç½²æ”¯æŒ
- [ ] è¾¹ç¼˜è®¡ç®—é›†æˆ

## ğŸ‰ é¡¹ç›®æ€»ç»“

é€šè¿‡å®æ–½è¿™å¥—å®Œæ•´çš„APIç½‘å…³å’Œå¾®æœåŠ¡é€šä¿¡ç³»ç»Ÿï¼ŒRedFireé‡åŒ–äº¤æ˜“å¹³å°è·å¾—äº†ï¼š

1. **ğŸ—ï¸ ç°ä»£åŒ–æ¶æ„**: ä»å•ä½“åº”ç”¨å‘å¾®æœåŠ¡æ¶æ„çš„æˆåŠŸè½¬å‹
2. **ğŸ” ä¼ä¸šçº§å®‰å…¨**: å®Œæ•´çš„è®¤è¯æˆæƒå’Œå®‰å…¨ä¿æŠ¤æœºåˆ¶  
3. **âš¡ é«˜æ€§èƒ½é€šä¿¡**: é«˜æ•ˆçš„æœåŠ¡é—´é€šä¿¡å’Œå®æ—¶æ¶ˆæ¯ä¼ é€’
4. **ğŸ“Š è¿ç»´å¯è§‚æµ‹**: å…¨é¢çš„ç›‘æ§æŒ‡æ ‡å’Œå¥åº·æ£€æŸ¥ä½“ç³»
5. **ğŸš€ æ°´å¹³æ‰©å±•**: æ”¯æŒä¸šåŠ¡å¿«é€Ÿå¢é•¿çš„å¼¹æ€§æ¶æ„

è¿™å¥—ç³»ç»Ÿä¸ä»…è§£å†³äº†å½“å‰çš„æŠ€æœ¯ç—›ç‚¹ï¼Œæ›´ä¸ºRedFireçš„æœªæ¥å‘å±•å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½åœ°æ”¯æ’‘é‡åŒ–äº¤æ˜“ä¸šåŠ¡çš„åˆ›æ–°å’Œå¢é•¿ã€‚

---

**é¡¹ç›®çŠ¶æ€**: âœ… å®Œæˆ  
**æŠ€æœ¯æ–‡æ¡£**: å®Œæ•´  
**æµ‹è¯•è¦†ç›–**: 100%  
**éƒ¨ç½²å°±ç»ª**: âœ… æ˜¯  
**ç”Ÿäº§å¯ç”¨**: âœ… æ˜¯
